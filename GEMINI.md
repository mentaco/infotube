# プロジェクト概要

本ドキュメントは、Rust言語を用いて開発される端末上情報表示ツール「Infotube」の機能要件および仕様を定義するものである。  
本ソフトウェアは、ターミナルマルチプレクサ（tmux、zellij等）における分割ペインの一区画を占有して動作することを想定しており、ニュースティッカー（電光掲示板）の形式を用いて、テキスト情報を連続的に提示する機能を有する。  

**主要な用途:**
* **情報提示:** ユーザーが事前に定義したテキストファイルの内容を循環表示し、学習支援や備忘録としての役割を果たす。  
* **リアルタイム通知:** 長時間を要するコマンド処理（ClaudeCodeのタスク完了、ビルドプロセスの終了等）の通知を受信し、即座に割り込み表示を行う。

# 機能要件

## 表示機能 (The Tube)

* **UIスタイル: スマート・ティッカー**  
  * **基本動作仕様:** すべてのテキスト情報は1つの連続したストリームとして扱われる。  
  * **長文テキストの処理:** 表示領域の幅を超えるテキストについては、右から左へと円滑に移動するアニメーション（マーキー表示）を適用する。テキスト長の上限は設けない。  
  * **短文テキストの処理:** 表示領域内に収まるテキストについては、アニメーションを行わず、画面中央（または設定された位置）に静止状態で表示する。表示時間の制限は設けない。  
* **視認性:**  
  * フォントカラーおよび背景色は、設定によりカスタマイズ可能とする。  
  * 「緊急通知（Alert）」等の重要情報については、色彩の変更や点滅表示などの視覚的強調を行い、ユーザーの注意を喚起する仕様とする。

## 情報ソース (Input Sources)

本システムは、情報の入力元として以下の2種類をサポートする。

1. **静的リスト (Static Info):**  
   * 事前に用意された外部テキストファイル（複数指定可）を読み込む。  
   * 各ファイル内の改行は「スペース4つ」に置換され、1行のテキストに結合される。  
   * 複数のファイルが指定された場合、ファイル間は「***」で結合される。  
   * 生成された全テキストはループ再生される。  
2. **動的イベント割り込み (Interrupt Info):**  
   * 外部からの入力を常時監視し、受信時は現在の再生ループに対し即座に割り込み表示を行う。  
   * **インターフェース:** TCP/UDPソケット通信を採用する。特定のポートをリッスンし、ネットワーク経由またはローカル環境からの通知を受信する。
3. **Web APIポーリング (Web API Polling):**
   * 設定されたWeb APIに対して定期的にリクエスト（GET）を行い、取得したデータを割り込み表示する。
   * **JSON対応:** JSONレスポンスから特定のフィールド（`/`区切りのパス）を抽出して表示することが可能。複数キーを指定して結合表示も可。
   * **用途例:** 地震情報、株価、天気予報などの定期チェック。
4. **WebSocketストリーム (WebSocket Stream):**
   * WebSocketサーバーに接続し、プッシュ通知されるイベントをリアルタイムで表示する。
   * **リアルタイム性:** ポーリングと異なり、サーバーからのイベント発生時に即座に表示される。
   * **用途例:** 地震速報（P2P Quake）、リアルタイムチャット通知など。

## 設定 (Configuration)

設定ファイル（config.toml）において、以下の項目を管理対象とする。

* 読み込み対象となるテキストファイルのパス（複数指定可）  
* Web APIソースの定義（URL、ポーリング間隔、抽出キー、有効/無効）
* WebSocketソースの定義（URL、抽出キー、有効/無効）
* テキスト移動アニメーションのデフォルト速度  
* 枠線(Frame)の表示/非表示
* 配色設定（通常表示時および緊急時）  
* リッスンを行うポート番号

## ユーザー操作インターフェース (Interactive Controls)

実行時において、キーボード操作による以下の制御機能を提供する。

* **一時停止/再開 (Pause/Resume):** テキストの流動および切り替えを一時的に停止する。  
* **速度調整:** アニメーションの移動速度を段階的に加速または減速させる。  
* **明度調整 (Brightness):** フォントの輝度を調整し、作業の妨げとならないよう視認性を最適化する。
* **フレーム表示切替:** 表示領域の枠線(Frame)の有無を切り替える。

# 技術スタック案

* **開発言語:** Rust  
* **TUIライブラリ:** ratatui (描画レンダリング制御)  
* **非同期処理:** tokio (TCPリスナーおよび描画ループの並行実行処理)  
* **HTTPクライアント:** reqwest (Web APIポーリング)
* **WebSocket:** tokio-tungstenite (リアルタイム通知)
* **設定管理:** serde, toml, serde_json

# 開発ルール
* **仕様書の同期:** 開発過程において仕様変更が生じる際は、必ず本ドキュメント（`GEMINI.md`）も変更し、常に実装と仕様の整合性を維持すること。
* **マニュアルの同期:** 操作や機能の変更、追加が生じる際は、必ず`README.md`も変更し、常に実装とマニュアルの整合性を維持すること。